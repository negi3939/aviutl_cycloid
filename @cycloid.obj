@サイクロイド歯車
--color:0xffff00
--check0:歯車同期,0
--track0:基礎半径,0,1000,200,0.5
--track1:描画半径,0,100,20,0.5
--track2:歯数,0,100,8,1
--track3:オフセット,-100,300,0,0.1
n= 5000
thickness = 10
rc = obj.getvalue(0)
rd = obj.getvalue(1)
rm = rc/obj.getvalue(2)
offsetr = obj.getvalue(3)
obj.load("figure","円",color,thickness)
theta=0
signoff = 1

cyclx ={}
cycly ={}

for ii=0,n-1 do
	theta = ii*2*math.pi/n 
	cycx = (rc+rm)*math.cos(theta)-rd*math.cos((rc+rm)/rm*theta)
	cycy = (rc+rm)*math.sin(theta)-rd*math.sin((rc+rm)/rm*theta)
	fcx = (rc+rm)*math.cos(theta)-rd*(rc+rm)/rm*math.cos((rc+rm)/rm*theta) 
	fcy = (rc+rm)*math.sin(theta)-rd*(rc+rm)/rm*math.sin((rc+rm)/rm*theta)
	if(fcx*cycx+fcy*cycy < 0) then
		signoff = 1
	else
		signoff = -1
	end
	cyclx[ii] = cycx + signoff*offsetr/math.sqrt(fcx*fcx+fcy*fcy)*fcx
	cycly[ii] = cycy + signoff*offsetr/math.sqrt(fcx*fcx+fcy*fcy)*fcy
end
for ii=0,n-1 do
	cth0 = math.rad(obj.getvalue("rz"))
	cx0 = cx0 or obj.getvalue("x")
	cy0 = cy0 or obj.getvalue("y")	
	cdx = cx0  + cyclx[ii]*math.cos(cth0) + cycly[ii]*math.sin(cth0)
	cdy = cy0  -cyclx[ii]*math.sin(cth0) + cycly[ii]*math.cos(cth0)
	obj.draw(cdx,cdy,0,0.5)
end